# Бот для начисления киберонов

## Инструкция

## Подготовка к использованию


В папке с исполняемым файлом bot.exe должны быть следующие файлы/папки:

   * `google-credentials.json` - файл учетных данных

   * `chromedriver-win64` - папка, внутри которой файл `chromedriver.exe`




## Где это все взять?


* Файл `google-credentials.json` генерируется с помощью google console
* `chromedriver.exe` - скачивается с сайта `hhttps://googlechromelabs.github.io/chrome-for-testing/`



## Драйвер

* заходим на сайт <hhttps://googlechromelabs.github.io/chrome-for-testing/>
* найдите на странице раздел `Stable`
* выберите нужную версию драйвера: `chromedriver - win64`
* скачайте драйвер
* в папке с программой создайте папку (либо из архива можно извлечь) - называем `chromedriver-win64`
* драйвер поместите в папку созданную на предыдущем шаге


## Файл учетных данных для доступа к гугл таблицам

Вдыхаем, набираемся терпения и сил. Выдыхаем. Поехали!

* заходим на сайт https://console.cloud.google.com/

* в левом углу открываем меню, выбираем `APIs & Services` -> `Enable APIs and Services`
* сверху нажимаем на `+ Enable APIs and Services`
* выбираем `Google Sheets API` (можно через поиск, можно на странице глазками найти, оно недалеко обычно)
* выбираем `ENABLE`
* так же ищем и выбираем `Google Drive API`
* выбираем `ENABLE`

Самое лёгкое позади! Едем дальше..


После включения этих двух АПИ:

* в левом боковом меню выбираем `Credentials`
* проверяем что возле надписи Google Cloud (сверху слева возле кнопки меню) есть надпись `google sheets` с тремя кружочками
* сверху нажимаем на `+ Create credentials`
* выбираем `Service account`

1й шаг. Тут просто анкета, ничего особенного.

* вводим имя аккаунта
* Service account ID - генерируется автоматически
* Description - оставляем пустым
* нажимаем `Create and continue`


2ой шаг. Надо дать себе права на доступ:
* `Role` - выбираем `Owner`
* нажимаем `Continue`

3й шаг.
* не заполняем, нажимаем `Done`



Ну, пошла жара. Вдохнем еще раз, наберемся сил и терпения. Поехали.

* заходим снова в меню, выбираем `APIs & Services` -> `Credentials`
* в самом низу есть раздел `Service Accounts`
* справа от него есть ссылка `Manage service accounts` - нажимаем, попадаем на сервис аккаунты.
* находим свой созданный, справа нажимаем на три точки, выбираем `manage keys`
* на странице нажимаем `add key` - `create new key`
* выбираем `json`


Cкачается файл:

* переименовываем его в `google-credentials.json`
* помещаем его в папку с исполняемым файлом


Это и есть файл учетных данных. Можно обновить страницу, в списке ключей появится новый, и будет статус `Active`

Всё? нет, не всё!

Заходим в гугл таблицы
* создаем новую таблицу
* называем ее `Кибероны`
* название листа - `Данные` (можно свое название придумать)
* сверху нажимаем на `Настройки доступа`
* откроется окно. в поле добавления нужно вписать свой адрес сервис аккаунта. он выглядит примерно так: `названиекотороевыпридумали@endless-gasket-436505-j1.iam.gserviceaccount.com`
* устанавливаем права `Редактор`
* нажимаем `Готово`


Вот теперь наконец-то можно пользоваться программой. Последний вдох, и погнали! Запускаем ``bot.exe`

## Программа:
* запускаем программу `bot.exe`
* видим много полей ввода. заполняем логин и пароль - это учетная запись от <https://kiber-one.club/> ОБЯЗАТЕЛЬНО - пароль от аккаунта должен быть сложным, иначе chrome будет показывать уведомление о ненадежном пароле и это будет ломать бота. (пока не нашел способ его закрыть ботом) 
* ссылка на таблицу - это ссылка на гугл таблицу заполненная по шаблону. ссылка не должна содержать лишнего. к примеру `https://docs.google.com/spreadsheets/d/1XU9SzrkQGtd6atfcc8fNK5nA7MYbvtbQaBmGMCZz0/edit?gid=390685838#gid=390685838` - тут лишнее `edit?gid=390685838#gid=390685838`. уберите лишнюю информацию из ссылки.
* название листа - вводим название листа из гугл таблицы
* путь к файлу учетных данных - путь к `google-credentials.json`
* чтобы не вводить все каждый раз - можно поставить опцию "запомнить". (с ней есть иногда баг, когда меняется путь к файлу учетных данных)
* нажимаем `Начать`



## Шаблон таблицы:

На 1ой строке - названия столбцов. Столбцы:

| фио	| активность	| штраф	| разминка |	дз |	бонус | пропуск |	бонус | поведение |	оплата |	др


### Правила заполнения таблицы:

* активность и штраф заполняются числами
* все остальные поля, если нужно выставить бонус, то заполняется текстом `да`. если бонуса нет, оставляем пустым.
* допускаются абсолютно пустые строки в таблице
* не допускаются дублирующиеся значения, иначе бот вылетит с ошибкой

Если бот вылетает в начале, когда начинает обрабатывать кибероны, значит есть ошибка в структуре с таблицей.
Бот используется уже год, и работает стабильно. Главное правило - в таблице должен быть порядок.

Поддержка (меня :D): <https://t.me/Xumpocmb>
